(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[465],{30588:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/marketplace",function(){return n(86852)}])},86852:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var o=n(35666),r=n.n(o),c=n(85893),s=n(9008),a=n(11163),i=n(67294),l=n(73193),d=n(37673),u=n(4433),m=n(84661),p=n(53621),f=n(82848),g=n(15021),h=n(77426),b=n(91621),x=n(39148),v=n(92357);function k(e,t,n,o,r,c,s){try{var a=e[c](s),i=a.value}catch(l){return void n(l)}a.done?t(i):Promise.resolve(i).then(o,r)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,c=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(i){r=!0,c=i}finally{try{o||null==a.return||a.return()}finally{if(r)throw c}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n(13550);function j(){var e=function(e){return e.json()},t=(0,a.useRouter)(),n=t.query,o=n.id,j=(n.detail,n.category),w=n.sequence,N=new b.X(["store_write","publish_data"]),S=new x.V({appConfig:N}),C=y(i.useState(),2)[1],A=i.useCallback((function(){return C({})}),[]),_=y(i.useState(!1),2),E=_[0],P=_[1],M=(0,i.useState)(!1),F=M[0],I=M[1],T=(0,i.useState)([]),q=T[0],O=T[1],R=(0,i.useState)([]),U=R[0],D=R[1],Z=(0,i.useState)(1),K=Z[0],B=Z[1],H=(0,i.useState)(9999),X=H[0],Y=H[1],J=(0,i.useState)("rank"),L=J[0],Q=J[1],V=(0,i.useState)([]),$=V[0],z=V[1],G=(0,i.useState)(!1),W=G[0],ee=G[1],te=(0,i.useState)(!1),ne=te[0],oe=te[1],re=(0,i.useState)(!1),ce=re[0],se=re[1],ae=(0,i.useState)(!1),ie=ae[0],le=ae[1],de=(0,i.useState)(!1),ue=de[0],me=de[1],pe=(0,i.useState)({name:"",image:"",attributes:{background:"",colour:"",clothing:"",hat:"",eyes:"",ears:"",nose:"",mouth:"",name:""},rarity:0,id:0,rank:0}),fe=pe[0],ge=pe[1],he=(0,i.useState)([]),be=he[0],xe=he[1],ve=function(e){ge(e),le(!0)};(0,i.useEffect)((function(){Ne(!0),A(),t.push("/marketplace?category=".concat(ue),void 0,{shallow:!0}),"false"==ue&&me("apes")}),[ue]),(0,i.useEffect)((function(){!function(){if(S.isSignInPending())S.handlePendingSignIn().then((function(e){xe(e)}));else if(S.isUserSignedIn()){var e=S.loadUserData();xe(e)}}()}),[]),(0,i.useEffect)((function(){j&&(ue||me(j))}),[j]),(0,i.useEffect)((function(){o&&(ne||oe(o))}),[o]),(0,i.useEffect)((function(){w&&(ce||se(w))}),[w]),t.query.category;var ke,ye=function(e){"up"===e?B(K+1):K-1>=1&&B(K-1),K<1&&B(1)},je=function(){t.push("/marketplace?category=".concat(ue,"&id=").concat(ne),void 0,{shallow:!0}),Ne(!0)},we=function(e){e&&t.push("/marketplace",void 0,{shallow:!0}),se(!1),oe("")},Ne=function(t){t&&(we(),B(1),Y(999));for(var n=[],o=0;o<q.length;o++)for(var r=q[o],c=0;c<r.options.length;c++)1==r.options[c].selected&&n.push({attributes:{$elemMatch:{trait_type:r.title,value:r.options[c].title}}});ne||we();var s,a=12*K-12,i="",l="";switch(ue){case"apes":i="".concat(g.vc.contracts.contractAddress(ue),".megapont-ape-club-nft"),l="marketplace";break;case"robots":i="".concat(g.vc.contracts.contractAddress(ue),".megapont-robot-nft"),l="marketplace";break;case"components":i="".concat(g.vc.contracts.contractAddress(ue),".megapont-robot-component-nft"),l="all_components"}"components"===ue&&ne&&(l="marketplace");var d="";switch(L){case"rank":d="ranking";break;case"id":d="token_id";break;case"price":d="list_price";break;default:d="ranking"}ne||(ne=""),"components"===ue&&ce&&ce.length>0&&(n=[{attributes:{$elemMatch:{trait_type:"Sequence",value:ce.toString()}}}]),i&&(-1!==i.indexOf("megapont-robot-nft")&&(i+='","'.concat(g.vc.contracts.contractAddress(),".").concat(g.vc.contracts.robotsclone.tokenContractName)),-1!==i.indexOf("megapont-robot-component-nft")&&(i+='","'.concat(g.vc.contracts.contractAddress(),".").concat(g.vc.contracts.componentsclone.tokenContractName)),s="".concat(g.vc.searchApiDomain,"/api/megapont/v2/").concat(l)+'?collectionId=01&contract_key=["'.concat(i,'"]')+"&sort=1"+"&query=".concat(d)+"&skip=".concat(a)+"&limit=12"+"&listed=".concat(W?"[true]":"[true,false]")+"&attributes=".concat(JSON.stringify(n))+"&token_ids=[".concat(ne,"]"),fetch(s,{}).then(e).then((function(e){Y(e.totalPages),D(e.docs),se(!1)})).catch((function(e){console.log("Request failed",e)})))},Se=function(e){ge(e),I(!0),t.query.detail&&t.push("/marketplace?category=".concat(ue,"&id=").concat(ne),void 0,{shallow:!0})},Ce=(ke=r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(be||be.profile||be.profile.stxAddress||be.profile.stxAddress.mainnet){t.next=2;break}return t.abrupt("return");case 2:try{fetch("https://stacks-node-api.mainnet.stacks.co/extended/v1/address/".concat(be.profile.stxAddress.mainnet,"/nft_events?limit=50&offset=0")).then(e).then((function(e){for(var t=e.nft_events.filter((function(e){return"SP3D6PV2ACBPEKYJTCMH7HEN02KP87QSP8KTEH335.megapont-ape-club-nft::Megapont-Ape-Club"===e.asset_identifier})),n=[],o=0;o<t.length;o++){var r=t[o].value.repr.replace("u","");n.push(r)}z(n)})).catch((function(e){console.log("Request failed",e)}))}catch(n){console.log(n)}case 3:case"end":return t.stop()}}),t)})),function(){var e=this,t=arguments;return new Promise((function(n,o){var r=ke.apply(e,t);function c(e){k(r,n,o,c,s,"next",e)}function s(e){k(r,n,o,c,s,"throw",e)}c(void 0)}))}),Ae=function(e){B(1),Q(e)};return(0,i.useEffect)((function(){!function(){var t="";switch(ue){case"apes":t="".concat(g.vc.contracts.contractAddress(ue),".megapont-ape-club-nft");break;case"robots":t="".concat(g.vc.contracts.contractAddress(ue),".megapont-robot-nft");break;case"components":t="".concat(g.vc.contracts.contractAddress(ue),".megapont-robot-component-nft")}fetch("".concat(g.vc.searchApiDomain,"/api/megapont/filters?key=").concat(t)).then(e).then((function(e){var t=[];for(var n in e[0].attributes){for(var o=e[0].attributes[n],r=[],c=0;c<o.length;c++){var s=o[c];"null"!=s.value&&r.push({selected:!1,title:s.value,total:Math.round(s.total),rarity:s.rarity})}r.sort((function(e,t){var n=e.title.toUpperCase(),o=t.title.toUpperCase();return n<o?-1:n>o?1:0})),t.push({title:n,selected:!1,selectedOptions:0,options:r})}O(t)})).catch((function(e){console.log("Request failed",e)}))}()}),[ue]),(0,i.useEffect)((function(){Ne(),A()}),[L,K,W]),(0,i.useEffect)((function(){Ce()}),[be]),(0,i.useEffect)((function(){t.query.id&&t.query.detail&&1==U.length&&Se(U[0])}),[U]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.default,{children:(0,c.jsx)("title",{children:"Megapont - Pixel Art NFT on Stacks"})}),(0,c.jsxs)("div",{className:"container mx-auto color-dark-text font-ibm-plex-mono",children:[(0,c.jsx)(d.Z,{userSession:S,currentUser:be,signOut:function(){S.signUserOut(),xe([])},authenticate:function(){(0,v.n)({appDetails:{name:"Megapont",icon:window.location.origin+"/images/logo.svg"},redirectTo:"/",onFinish:function(){var e=S.loadUserData();xe(e)},userSession:S})}}),(0,c.jsx)("div",{className:"text-center my-32 mb-10",children:(0,c.jsx)("h1",{className:"text-3xl lg:text-6xl font-syne font-bold",children:"MARKETPLACE"})}),(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"flex w-96 mb-32 mx-auto",children:[(0,c.jsx)("button",{className:"flex-1 border rounded-l-lg border-megapont-dark p-2 py-3 text-sm border-b-4 ".concat("apes"==ue?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter "),onClick:function(){me("apes")},children:"Apes"}),(0,c.jsx)("button",{className:"flex-1 border  border-megapont-dark p-2 py-3 text-sm border-b-4  ".concat("robots"==ue?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter"),onClick:function(){me("robots")},children:"Robots"}),(0,c.jsx)("button",{className:"flex-1 border rounded-r-lg border-megapont-dark p-2 py-3 text-sm border-b-4 border-r-4 ".concat("components"==ue?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter "),onClick:function(){me("components")},children:"Components"})]})}),(0,c.jsx)(u.Z,{}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:flex",children:[(0,c.jsxs)("div",{className:" md:w-1/3 md:max-w-[300px] md:border-r border-megapont-dark md:pr-8",children:[(0,c.jsxs)("div",{className:"border-t border-b py-3 px-6 text-sm border-megapont-dark flex md:hidden",onClick:function(){P(!E)},children:[(0,c.jsx)("p",{className:"w-1/2",children:"Filters"}),(0,c.jsx)("div",{className:"text-right w-1/2",children:(0,c.jsx)("img",{src:"images/icons/filter.svg",className:"float-right"})})]}),(0,c.jsxs)("div",{className:"".concat(E?"block":"hidden"," md:block m-6 md:m-0"),children:[(0,c.jsx)("p",{className:"font-syne font-bold text-lg mt-10 mb-4",children:"SEARCH BY ID"}),(0,c.jsxs)("div",{className:"flex",children:[(0,c.jsx)("input",{type:"text",className:"flex-grow border border-t-4 bg-[#F9F9F9] rounded-l-lg border-megapont-dark p-2 py-3 text-sm",placeholder:"E.g. 1066",value:ne,onChange:function(e){oe(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(oe(e.target.value),je())}}),(0,c.jsx)("button",{onClick:function(){je()},className:"flex-none hover:bg-opacity-90 bg-megapont-dark p-3 px-4 rounded-r-lg",children:(0,c.jsx)("img",{src:"/images/icons/search.svg"})})]}),(0,c.jsx)("p",{className:"font-syne font-bold text-lg mt-10 mb-4",children:"SORT BY"}),(0,c.jsxs)("div",{className:"flex",children:[(0,c.jsx)("button",{className:"flex-grow border rounded-l-lg border-megapont-dark p-2 py-3 text-sm border-b-4 ".concat("rank"==L?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter "),onClick:function(){Ae("rank")},children:"Rank"}),(0,c.jsx)("button",{className:"flex-grow border  border-megapont-dark p-2 py-3 text-sm border-b-4  ".concat("id"==L?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter"),onClick:function(){Ae("id")},children:"Mint"}),(0,c.jsx)("button",{className:"flex-grow border rounded-r-lg border-megapont-dark p-2 py-3 text-sm border-b-4 border-r-4 ".concat("price"==L?"bg-white font-medium border-t-4 border-b-2":"bg-megapont-lighter "),onClick:function(){Ae("price")},children:"Price"})]}),(0,c.jsxs)("div",{className:"font-ibm-plex-mono text-sm mt-5 flex",children:[(0,c.jsx)("button",{className:"p-1 border border-t-[3px] h-8 w-8 bg-[#F9F9F9] rounded-lg border-megapont-dark text-center",onClick:function(){ee(!W)},children:(0,c.jsx)("img",{src:"/images/icons/check-grey.svg",className:"".concat(W?"":"hidden"," h-4 w-4 ml-1")})}),(0,c.jsx)("span",{className:"pl-3 pt-2",children:"For sale only"})]}),(0,c.jsx)("p",{className:"font-syne font-bold text-lg mt-10 mb-3",children:"FILTER BY TRAITS"}),(0,c.jsx)("div",{className:"h-[100vh] scrollbar-thin scrollbar-rounded scrollbar-thumb-megapont-dark scrollbar-track-megapont-lighter scrollbar-thumb-rounded scrollbar-track-rounded",children:(0,c.jsx)("ul",{className:"text-sm mb-6",children:q.map((function(e,t){return(0,c.jsxs)("li",{className:"py-2 cursor-pointer select-none",onClick:function(){!function(e,t){we(!0),e.selected=!e.selected,A()}(e)},children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("img",{src:"images/icons/list-arrow-".concat(e.selected?"down":"right",".svg"),className:"float-left pr-3"}),(0,c.jsx)("span",{className:"font-medium",children:e.title}),e.selectedOptions>0&&(0,c.jsx)("span",{className:"float-right bg-megapont-dark text-white rounded-xl px-3 py-1 text-xs mr-3",children:e.selectedOptions})]}),(0,c.jsx)("ol",{className:"pt-3 ".concat(e.selected?"block":"hidden"),children:e.options.map((function(t,n){if(t.title)return(0,c.jsxs)("li",{className:" hover:bg-gray-50 hover:rounded-lg py-2",onClick:function(n){n.stopPropagation(),function(e,t,n){we(!0),t.selected=!t.selected;var o=0;e.options.map((function(e){e.selected&&o++})),e.selectedOptions=o,O(q),Ne(!0),A()}(e,t)},children:[t.selected?(0,c.jsx)("img",{src:"images/icons/cross.svg",className:"float-left"}):""," ",(0,c.jsxs)("p",{className:"pl-8",children:[t.title," "]})]},n)}))})]},t)}))})})]})]}),(0,c.jsxs)("div",{className:"md:flex-grow mt-6 sm:mt-10",children:[(0,c.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-6 sm:gap-y-10 p-6 pt-0",children:[U&&U.map((function(e,t){return(0,c.jsx)(h.Z,{data:e,showModalForApe:Se,listItem:ve,currentUser:be,buyItem:f.m9,unlistItem:f._M,userApes:$,category:ue},t)})),U&&0===U.length&&(0,c.jsx)("p",{className:"col-span-2 lg:col-span-3 xl:col-span-4",children:"No results found. Try changing your search options."})]}),(0,c.jsxs)("div",{className:"grid grid-cols-3 gap-4 xl:gap-40 p-6 border-t border-megapont-dark ".concat(0===U.length?"hidden":""),children:[K>1&&(0,c.jsx)("button",{className:"border border-megapont-dark rounded-lg text-center p-4",onClick:function(){ye("down")},children:"Previous"}),1==K&&(0,c.jsx)("p",{children:"\xa0"}),(0,c.jsx)("p",{children:"\xa0"}),X!=K&&(0,c.jsx)("button",{className:"border border-megapont-dark rounded-lg text-center p-4",onClick:function(){ye("up")},children:"Next"}),X==K&&(0,c.jsx)("p",{children:"\xa0"})]})]})]})]}),(0,c.jsx)(l.Z,{links:{discord:"https://discord.com/invite/p2QFXxwbDe",twitter:"https://twitter.com/MegapontNFT",stacks:"https://www.stacks.co/",stacksArt:"https://www.stacksart.com/"}}),(0,c.jsx)(p.Z,{marketplaceItem:fe,currentUser:be,closeModal:function(){I(!1)},showModal:F,buyItem:f.m9,marketplaceCategory:ue}),(0,c.jsx)(m.Z,{showModal:ie,ape:fe,listItem:f.qb,onCancel:null,closeModal:function(){le(!1)}})]})}}},function(e){e.O(0,[261,898,868,245,981,774,888,179],(function(){return t=30588,e(e.s=t);var t}));var t=e.O();_N_E=t}]);